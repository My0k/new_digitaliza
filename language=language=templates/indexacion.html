// Nueva función para finalizar la indexación
function finalizeIndexing() {
    // Obtener valores del formulario
    const projectCode = document.getElementById('projectCode').value.trim();
    const boxNumber = document.getElementById('boxNumber').value.trim();
    const documentPresent = document.querySelector('input[name="documentPresent"]:checked').value;
    const observation = document.getElementById('observation').value.trim();
    const folderSelect = document.getElementById('folderSelect');
    const folderId = folderSelect.value;
    
    // Validar que se haya ingresado un código de proyecto
    if (!projectCode) {
        alert('Falta código de proyecto');
        return;
    }
    
    // Validar que se haya seleccionado una carpeta
    if (!folderId) {
        alert('Por favor, seleccione una carpeta');
        return;
    }
    
    // Mostrar indicador de carga
    const button = document.getElementById('indexDocumentBtn');
    const originalText = button.innerHTML;
    button.disabled = true;
    button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Guardando...';
    
    // Preparar datos para enviar al servidor
    const data = {
        projectCode: projectCode,
        boxNumber: boxNumber,
        documentPresent: documentPresent,
        observation: observation,
        folderId: folderId
    };
    
    // Enviar datos al servidor
    fetch('/update_indexing', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Mostrar mensaje de éxito
            button.classList.remove('btn-primary');
            button.classList.add('btn-success');
            button.innerHTML = '<i class="fas fa-check-circle me-2"></i> Guardado con éxito';
            
            // Recargar la página después de 2 segundos
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        } else {
            // Mostrar mensaje de error
            button.classList.remove('btn-primary');
            button.classList.add('btn-danger');
            button.innerHTML = '<i class="fas fa-times-circle me-2"></i> Error al guardar';
            
            // Alerta con el mensaje de error
            alert('Error: ' + data.error);
            
            // Restaurar el botón después de 3 segundos
            setTimeout(() => {
                button.disabled = false;
                button.classList.remove('btn-danger');
                button.classList.add('btn-primary');
                button.innerHTML = originalText;
            }, 3000);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        
        // Mostrar mensaje de error
        button.classList.remove('btn-primary');
        button.classList.add('btn-danger');
        button.innerHTML = '<i class="fas fa-times-circle me-2"></i> Error al guardar';
        
        // Alerta con el mensaje de error
        alert('Error al procesar la solicitud. Por favor, intente nuevamente.');
        
        // Restaurar el botón después de 3 segundos
        setTimeout(() => {
            button.disabled = false;
            button.classList.remove('btn-danger');
            button.classList.add('btn-primary');
            button.innerHTML = originalText;
        }, 3000);
    });
} 